# loo

### Efficient approximate leave-one-out cross-validation for fitted Bayesian models

**loo** is an R package that allows users to compute efficient
approximate leave-one-out cross-validation for fitted Bayesian models,
as well as model weights that can be used to average predictive
distributions. The **loo** package package implements the fast and
stable computations for approximate LOO-CV

- Vehtari, A., Gelman, A., and Gabry, J. (2017). Practical Bayesian
  model evaluation using leave-one-out cross-validation and WAIC.
  *Statistics and Computing*. 27(5): 1413-1432.
  [Journal](https://dx.doi.org/10.1007/s11222-016-9696-4), [arXiv
  preprint](https://arxiv.org/abs/1507.04544)

- Vehtari, A., Simpson, D., Gelman, A., Yao, Y., and Gabry, J. (2024).
  Pareto smoothed importance sampling. *Journal of Machine Learning
  Research*, 25(72): 1-58.
  [Journal](https://jmlr.org/papers/v25/19-556.html), [arXiv
  preprint](https://arxiv.org/abs/1507.02646)

and computes model weights as described in

- Yao, Y., Vehtari, A., Simpson, D., and Gelman, A. (2018). Using
  stacking to average Bayesian predictive distributions. *Bayesian
  Analysis* 13(3): 917-1007.
  [Journal](https://dx.doi.org/10.1214/17-BA1091), [arXiv
  preprint](https://arxiv.org/abs/1704.02030)

From existing posterior simulation draws, we compute approximate LOO-CV
using Pareto smoothed importance sampling (PSIS), a new procedure for
regularizing importance weights. As a byproduct of our calculations, we
also obtain approximate standard errors for estimated predictive errors
and for comparing predictive errors between two models. We recommend
PSIS-LOO-CV instead of WAIC, because PSIS provides useful diagnostics
and effective sample size and Monte Carlo standard error estimates.

### Resources

- [mc-stan.org/loo](https://mc-stan.org/loo) (online documentation,
  vignettes)
- [Ask a question](https://discourse.mc-stan.org) (Stan Forums on
  Discourse)
- [Open an issue](https://github.com/stan-dev/loo/issues) (GitHub issues
  for bug reports, feature requests)

### Installation

- Install the latest release from CRAN:

``` r
install.packages("loo")
```

- Install the latest development version from GitHub:

``` r
# install.packages("remotes")
remotes::install_github("stan-dev/loo")
```

We do *not* recommend setting `build_vignettes=TRUE` when installing
from GitHub because some of the vignettes take a long time to build and
are always available online at
[mc-stan.org/loo/articles/](https://mc-stan.org/loo/articles/).

### Python and Matlab/Octave Code

Corresponding Python and Matlab/Octave code can be found at the
[avehtari/PSIS](https://github.com/avehtari/PSIS) repository.

### Contributing to loo

Contributions are welcome! **loo** is under active development and pull
requests are always appreciated. Bugs, ideas (with or without
implementations) should be noted by [opening an
issue](https://github.com/stan-dev/loo/issues). Please read
[CONTRIBUTING.md](https://github.com/stan-dev/loo/blob/master/.github/CONTRIBUTING.md)
for further details.

### License

The code is distributed under the GPL 3 license. The documentation is
distributed under the CC BY 4.0 license.

# Package index

## Package description, glossary, and included data sets

- [`loo-package`](https://mc-stan.org/loo/reference/loo-package.md) :
  Efficient LOO-CV and WAIC for Bayesian models
- [`loo-glossary`](https://mc-stan.org/loo/reference/loo-glossary.md) :
  LOO package glossary
- [`loo-datasets`](https://mc-stan.org/loo/reference/loo-datasets.md)
  [`Kline`](https://mc-stan.org/loo/reference/loo-datasets.md)
  [`milk`](https://mc-stan.org/loo/reference/loo-datasets.md)
  [`voice`](https://mc-stan.org/loo/reference/loo-datasets.md)
  [`voice_loo`](https://mc-stan.org/loo/reference/loo-datasets.md) :
  Datasets for loo examples and vignettes

## Approximate LOO-CV

Approximate LOO-CV, Pareto smoothed importance sampling (PSIS), and
diagnostics.

- [`loo()`](https://mc-stan.org/loo/reference/loo.md)
  [`loo_i()`](https://mc-stan.org/loo/reference/loo.md)
  [`is.loo()`](https://mc-stan.org/loo/reference/loo.md)
  [`is.psis_loo()`](https://mc-stan.org/loo/reference/loo.md) :
  Efficient approximate leave-one-out cross-validation (LOO)
- [`loo_subsample()`](https://mc-stan.org/loo/reference/loo_subsample.md)
  : Efficient approximate leave-one-out cross-validation (LOO) using
  subsampling, so that less costly and more approximate computation is
  made for all LOO-fold, and more costly and accurate computations are
  made only for m\<N LOO-folds.
- [`loo_approximate_posterior()`](https://mc-stan.org/loo/reference/loo_approximate_posterior.md)
  : Efficient approximate leave-one-out cross-validation (LOO) for
  posterior approximations
- [`loo_moment_match()`](https://mc-stan.org/loo/reference/loo_moment_match.md)
  : Moment matching for efficient approximate leave-one-out
  cross-validation (LOO)
- [`loo_moment_match_split()`](https://mc-stan.org/loo/reference/loo_moment_match_split.md)
  : Split moment matching for efficient approximate leave-one-out
  cross-validation (LOO)
- [`E_loo()`](https://mc-stan.org/loo/reference/E_loo.md) : Compute
  weighted expectations
- [`psis()`](https://mc-stan.org/loo/reference/psis.md)
  [`is.psis()`](https://mc-stan.org/loo/reference/psis.md)
  [`is.sis()`](https://mc-stan.org/loo/reference/psis.md)
  [`is.tis()`](https://mc-stan.org/loo/reference/psis.md) : Pareto
  smoothed importance sampling (PSIS)
- [`ap_psis()`](https://mc-stan.org/loo/reference/ap_psis.md) : Pareto
  smoothed importance sampling (PSIS) using approximate posteriors
- [`tis()`](https://mc-stan.org/loo/reference/tis.md) : Truncated
  importance sampling (TIS)
- [`sis()`](https://mc-stan.org/loo/reference/sis.md) : Standard
  importance sampling (SIS)
- [`importance_sampling()`](https://mc-stan.org/loo/reference/importance_sampling.md)
  : A parent class for different importance sampling methods.
- [`weights(`*`<importance_sampling>`*`)`](https://mc-stan.org/loo/reference/weights.importance_sampling.md)
  : Extract importance sampling weights
- [`pareto_k_table()`](https://mc-stan.org/loo/reference/pareto-k-diagnostic.md)
  [`pareto_k_ids()`](https://mc-stan.org/loo/reference/pareto-k-diagnostic.md)
  [`pareto_k_values()`](https://mc-stan.org/loo/reference/pareto-k-diagnostic.md)
  [`pareto_k_influence_values()`](https://mc-stan.org/loo/reference/pareto-k-diagnostic.md)
  [`psis_n_eff_values()`](https://mc-stan.org/loo/reference/pareto-k-diagnostic.md)
  [`mcse_loo()`](https://mc-stan.org/loo/reference/pareto-k-diagnostic.md)
  [`plot(`*`<psis_loo>`*`)`](https://mc-stan.org/loo/reference/pareto-k-diagnostic.md)
  [`plot(`*`<psis>`*`)`](https://mc-stan.org/loo/reference/pareto-k-diagnostic.md)
  : Diagnostics for Pareto smoothed importance sampling (PSIS)

## Model comparison weighting/averaging

Functions for comparing models and computing model weights via stacking
of predictive distributions or pseudo-BMA weighting.

- [`loo_compare()`](https://mc-stan.org/loo/reference/loo_compare.md)
  [`print(`*`<compare.loo>`*`)`](https://mc-stan.org/loo/reference/loo_compare.md)
  [`print(`*`<compare.loo_ss>`*`)`](https://mc-stan.org/loo/reference/loo_compare.md)
  : Model comparison
- [`loo_model_weights()`](https://mc-stan.org/loo/reference/loo_model_weights.md)
  [`stacking_weights()`](https://mc-stan.org/loo/reference/loo_model_weights.md)
  [`pseudobma_weights()`](https://mc-stan.org/loo/reference/loo_model_weights.md)
  : Model averaging/weighting via stacking or pseudo-BMA weighting

## Helper functions for K-fold CV

- [`kfold_split_random()`](https://mc-stan.org/loo/reference/kfold-helpers.md)
  [`kfold_split_stratified()`](https://mc-stan.org/loo/reference/kfold-helpers.md)
  [`kfold_split_grouped()`](https://mc-stan.org/loo/reference/kfold-helpers.md)
  : Helper functions for K-fold cross-validation
- [`kfold()`](https://mc-stan.org/loo/reference/kfold-generic.md)
  [`is.kfold()`](https://mc-stan.org/loo/reference/kfold-generic.md) :
  Generic function for K-fold cross-validation for developers
- [`elpd()`](https://mc-stan.org/loo/reference/elpd.md) : Generic
  (expected) log-predictive density

## Other functions

- [`loo_predictive_metric()`](https://mc-stan.org/loo/reference/loo_predictive_metric.md)
  : Estimate leave-one-out predictive performance..

- [`crps()`](https://mc-stan.org/loo/reference/crps.md)
  [`scrps()`](https://mc-stan.org/loo/reference/crps.md)
  [`loo_crps()`](https://mc-stan.org/loo/reference/crps.md)
  [`loo_scrps()`](https://mc-stan.org/loo/reference/crps.md) :
  Continuously ranked probability score

- [`elpd()`](https://mc-stan.org/loo/reference/elpd.md) : Generic
  (expected) log-predictive density

- [`waic()`](https://mc-stan.org/loo/reference/waic.md)
  [`is.waic()`](https://mc-stan.org/loo/reference/waic.md) : Widely
  applicable information criterion (WAIC)

- [`extract_log_lik()`](https://mc-stan.org/loo/reference/extract_log_lik.md)
  : Extract pointwise log-likelihood from a Stan model

- [`pointwise()`](https://mc-stan.org/loo/reference/pointwise.md) :
  Convenience function for extracting pointwise estimates

- [`relative_eff()`](https://mc-stan.org/loo/reference/relative_eff.md)
  : Convenience function for computing relative efficiencies

- [`gpdfit()`](https://mc-stan.org/loo/reference/gpdfit.md) : Estimate
  parameters of the Generalized Pareto distribution

- [`example_loglik_array()`](https://mc-stan.org/loo/reference/example_loglik_array.md)
  [`example_loglik_matrix()`](https://mc-stan.org/loo/reference/example_loglik_array.md)
  : Objects to use in examples and tests

- [`print(`*`<loo>`*`)`](https://mc-stan.org/loo/reference/print.loo.md)
  [`print(`*`<waic>`*`)`](https://mc-stan.org/loo/reference/print.loo.md)
  [`print(`*`<psis_loo>`*`)`](https://mc-stan.org/loo/reference/print.loo.md)
  [`print(`*`<importance_sampling_loo>`*`)`](https://mc-stan.org/loo/reference/print.loo.md)
  [`print(`*`<psis_loo_ap>`*`)`](https://mc-stan.org/loo/reference/print.loo.md)
  [`print(`*`<psis>`*`)`](https://mc-stan.org/loo/reference/print.loo.md)
  [`print(`*`<importance_sampling>`*`)`](https://mc-stan.org/loo/reference/print.loo.md)
  : Print methods

- [`nobs(`*`<psis_loo_ss>`*`)`](https://mc-stan.org/loo/reference/nobs.psis_loo_ss.md)
  :

  The number of observations in a `psis_loo_ss` object.

- [`obs_idx()`](https://mc-stan.org/loo/reference/obs_idx.md) : Get
  observation indices used in subsampling

- [`update(`*`<psis_loo_ss>`*`)`](https://mc-stan.org/loo/reference/update.psis_loo_ss.md)
  :

  Update `psis_loo_ss` objects

## Deprecated functions

- [`compare()`](https://mc-stan.org/loo/reference/compare.md) : Model
  comparison (deprecated, old version)
- [`psislw()`](https://mc-stan.org/loo/reference/psislw.md) : Pareto
  smoothed importance sampling (deprecated, old version)

# Articles

### Getting started

These vignettes demonstrate how to use the **loo** package to perform
approximate leave-one-out cross-validation or exact K-fold
cross-validation for Bayesian models fit using MCMC, compare models on
estimated predictive performance on new data, and weight models for
averaging predictive distributions.

- [Using the loo package (version \>=
  2.0.0)](https://mc-stan.org/loo/articles/loo2-example.md):
- [Bayesian Stacking and Pseudo-BMA weights using the loo
  package](https://mc-stan.org/loo/articles/loo2-weights.md):
- [Writing Stan programs for use with the loo
  package](https://mc-stan.org/loo/articles/loo2-with-rstan.md):
- [Holdout validation and K-fold cross-validation of Stan programs with
  the loo package](https://mc-stan.org/loo/articles/loo2-elpd.md):

### Additional topics

These vignettes demonstrate how to use the **loo** package for more
complicated scenarios including models with non-factorized likelihoods,
forecasting models, models fit to very large datasets, and more.

- [Leave-one-out cross-validation for non-factorized
  models](https://mc-stan.org/loo/articles/loo2-non-factorized.md):
- [Approximate leave-future-out cross-validation for Bayesian time
  series models](https://mc-stan.org/loo/articles/loo2-lfo.md):
- [Using Leave-one-out cross-validation for large
  data](https://mc-stan.org/loo/articles/loo2-large-data.md):
- [Avoiding model refits in leave-one-out cross-validation with moment
  matching](https://mc-stan.org/loo/articles/loo2-moment-matching.md):
- [Mixture IS leave-one-out cross-validation for high-dimensional
  Bayesian models](https://mc-stan.org/loo/articles/loo2-mixis.md):

### Frequently asked questions

- [Cross-validation FAQ](https://users.aalto.fi/~ave/CV-FAQ.html):

  Answers to frequently asked questions about cross-validation and the
  **loo** package (links to external site).
